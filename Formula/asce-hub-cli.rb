# frozen_string_literal: true

require_relative "../lib/registry_download"

class AsceHubCli < Formula
  desc "CLI for interacting with ACE Hub"
  homepage "https://git.act3-ace.com/ace/hub/cli"
  version "0.2.0"

  # Generated by https://git.act3-ace.com/ace/homebrew-ace-tools/-/blob/master/bin/formulize.sh
  on_macos do
    if Hardware::CPU.intel?
      url "reg.git.act3-ace.com/ace/hub/cli/releases/hub@sha256:4de7417c7d2abe69f37b0a9447c2a578a6a15dea7c001ff11e7a1e5c1130eb81",
          using: BlobDownloadStrategy
      sha256 "4de7417c7d2abe69f37b0a9447c2a578a6a15dea7c001ff11e7a1e5c1130eb81"
    end
    if Hardware::CPU.arm?
      url "reg.git.act3-ace.com/ace/hub/cli/releases/hub@sha256:34a7cd983a5534f0199f2f39b1f4624590b53a2d07159abc7155ef1df7e72fc1",
          using: BlobDownloadStrategy
      sha256 "34a7cd983a5534f0199f2f39b1f4624590b53a2d07159abc7155ef1df7e72fc1"
    end
  end

  # Generated by https://git.act3-ace.com/ace/homebrew-ace-tools/-/blob/master/bin/formulize.sh
  on_linux do
    if Hardware::CPU.arm? && Hardware::CPU.is_64_bit?
      url "reg.git.act3-ace.com/ace/hub/cli/releases/hub@sha256:53fa2dd0e68009272127c2812c8d919e323febc837882a83686a0a2579b8207f",
          using: BlobDownloadStrategy
      sha256 "53fa2dd0e68009272127c2812c8d919e323febc837882a83686a0a2579b8207f"
    end
    if Hardware::CPU.intel?
      url "reg.git.act3-ace.com/ace/hub/cli/releases/hub@sha256:71f5bfe1c3a7e8a40a35cfa033f8ae13ab271f9d83c78889bbf1194300a1d8e3",
          using: BlobDownloadStrategy
      sha256 "71f5bfe1c3a7e8a40a35cfa033f8ae13ab271f9d83c78889bbf1194300a1d8e3"
    end
  end

  def install
    bin.install "hub"

    with_homebrew_path do
      # Completions from downstream tools are sourced by asce,
      # so they must be discoverable on the PATH
      generate_completions_from_executable(bin/"hub", "completion")
    end

    # Generate manpages
    mkdir "man" do
      system bin/"hub", "gendocs", "man", "."
      man1.install Dir["*.1"]
      # man5.install Dir["*.5"]
    end
  end

  # test do
  #   system "#{bin}/hub", "version"
  # end
end
